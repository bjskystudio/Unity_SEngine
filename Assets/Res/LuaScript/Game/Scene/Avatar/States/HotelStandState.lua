---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by asd.
--- DateTime: 2022/11/17 18:47
---
local AvatarState = require("AvatarState")
local AvatarStateMachine = require("AvatarStateMachine")
local MapManager = require("MapManager")
local SceneManager = require("SceneManager")
local Vector3 = Vector3

---@class HotelStandState:AvatarState 旅店静止
---@field Machine AvatarStateMachine
local HotelStandState = Class("HotelStandState",AvatarState)


---进入状态
---@override
function HotelStandState:Enter()
    self.StartTime = self.Machine.Time
    ---设置动作
    self.Machine:SetInfoAnim("idle",true)
    self.Machine:SetInfoSkin("Guest_1")
end


---退出状态
---@override
function HotelStandState:Exit()
    self.StartTime = 0
end

---状态机更新
---@override
function HotelStandState:Update()
    local time = self.Machine.Time
    ---1秒后move
    if time -self.StartTime > 0.2 then
        --验证目的地
        local pos = self:CheckGoto()
        self.Machine.Info.GotoPos = pos
        self.Machine:ChangeState(AvatarStateMachine.eStateName.HotelMove)
    end
end

---去哪个房间
---@return MapManager.ePosition 位置
function HotelStandState:CheckGoto()
    local pos = 0
    ---现在逻辑只是去休息室
    if not table.ContainsValue(self.Machine.Info.FinishRoomIds,SceneManager.eRoomId.Lounge) then
        --去休息室排队
        pos = MapManager.ePosition.LoungeRoomWait
    else
        --出去
        pos = MapManager.ePosition.OutPoint
    end
    return pos
end

return HotelStandState